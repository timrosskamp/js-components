class t{constructor(t){this.value=t}}const e=/^((\S+)\s*->\s*)?(([^\s#]+)\s*#\s*)?([^\s(]+)\s*\(([^)]*)\)\s*(.+)?$/i;function n(t,e,n){if(t.has(e))return t.get(e);const s=n();return t.set(e,s),s}class s{constructor(t){this.t={},this.element=t}get data(){if(!this.i)throw new Error("Can't access data before component has been set up.");return this.i}o(t){this.i=t({element:this.element,u:t=>{var e;return(null===(e=this.t[t])||void 0===e?void 0:e[0])||null},h:t=>this.t[t]||[]})}l(t,e){this.t[e.p]?this.t[e.p].push(t):this.t[e.p]=[t]}m(e,n){if(!(n.method in this.data))return void console.warn(`Function '${n.method}' does not exist in Component.`,e);const s=this.data[n.method];if("function"!=typeof s)return void console.warn(`'${n.method}' is not a function.`,e);let i=n.event;i||(i=function(t){switch(t.tagName.toLowerCase()){case"a":case"button":return"click";case"form":return"submit";case"input":return"submit"==t.getAttribute("type")?"click":"input";case"select":return"change";case"textarea":return"input"}}(e),i)?e.addEventListener(i,(function(e){const i=n.options.map((n=>n instanceof t?"$event"==n.value?e:n.value:n));s(...i)})):console.warn("No default event type found for element. Add an event type to the on directive.",e)}}const i=/^(([^\s#]+)\s*#\s*)?(\S+)\s*(.*)$/i;class o{constructor(t={}){this.v=new Map,this.$=new WeakMap,this.prefix=t.prefix||"x"}define(t,e){this.v.set(t,e)}k(n=document.body){n.querySelectorAll(`[${this.prefix}-ref]`).forEach((t=>{(function(t){const e=[];for(;t.trim();){const n=t.match(i);if(!n)return console.error(`Descriptor '${t}' is invalid.`),[];e.push({identifier:n[2],p:n[3]}),t=n[4]||""}return e})(t.getAttribute(`${this.prefix}-ref`)).forEach((e=>{const n=this.C(t,e.identifier);if(n){this.D(n.element,n.identifier).l(t,e)}}))})),n.querySelectorAll(`[${this.prefix}-component]`).forEach((t=>{t.getAttribute(`${this.prefix}-component`).split(/\s+/).filter((t=>t.length)).forEach((e=>{const n=this.v.get(e);if(!n)return void console.warn(`Definition for '${e}' is missing.`);this.D(t,e).o(n)}))})),n.querySelectorAll(`[${this.prefix}-on]`).forEach((n=>{(function(n){const s=[];for(;n.trim();){const o=n.match(e);if(!o)return console.error(`Descriptor '${n}' is invalid.`),[];s.push({event:o[1]?o[1].slice(0,-2).trim():void 0,identifier:o[4],method:o[5],options:o[6]?(i=o[6],i.split(",").map((t=>t.trim())).filter((t=>t.length)).map((e=>{if("undefined"!=e)return"null"==e?null:"true"==e||"false"!=e&&(isNaN(parseFloat(e))?"'"==e.charAt(0)&&"'"==e.charAt(e.length)||'"'==e.charAt(0)&&'"'==e.charAt(e.length)?e.slice(1,e.length-1):new t(e):parseFloat(e))}))):[]}),n=o[7]||""}var i;return s})(n.getAttribute(`${this.prefix}-on`)).forEach((t=>{const e=this.C(n,t.identifier);if(e){this.D(e.element,e.identifier).m(n,t)}}))}))}D(t,e){const i=n(this.$,t,(()=>new Map));return n(i,e,(()=>new s(t)))}C(t,e=null){let n;if(e){if(n=t.closest(`[${this.prefix}-component~="${e}"]`),!n)return void console.warn(`Element is not inside a component named '${e}'.`,t)}else{if(n=t.closest(`[${this.prefix}-component]`),!n)return void console.warn("Element is not inside a component.",t);const s=n.getAttribute(`${this.prefix}-component`).split(/\s+/).filter((t=>t.length));if(s.length>1)return void console.warn("Element requires the component name. Add the name of the component to all directives.",t);e=s[0]}return{identifier:e,element:n}}}export{o as Application};
